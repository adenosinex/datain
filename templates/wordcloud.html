<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>词云生成</title>
    <script src="/static/cdn/vue3.5.global.js"></script>
    <script src="/static/cdn/axios1.1.min.js"></script>
    <script src="/static/cdn/tailwindcss3.4.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
<div id="app" class="max-w-xl mx-auto mt-8 p-6 bg-white rounded-lg shadow">
    <h2 class="text-2xl font-bold mb-4 text-blue-700">词云生成</h2>
    <textarea v-model="text" rows="6" class="w-full border rounded mb-4 p-2" placeholder="输入文字"></textarea>
    <button @click="genCloud" class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">生成词云</button>
    <div v-if="img" class="mt-6">
        <img :src="'data:image/png;base64,'+img" alt="词云图" class="rounded shadow">
        <div class="text-gray-500 mt-2">
            生成时间：${genTime}<br>
            输入字数：${wordCount}<br>
            每秒处理量：${speed}
        </div>
    </div>
    <div v-if="error" class="text-red-500 mt-2">${error}</div>
</div>
<script>
const { createApp } = Vue;
createApp({
    delimiters: ['${', '}'],
    data() {
        return { text: '', img: '', error: '', genTime: '', wordCount: 0, speed: '' }
    },
    methods: {
        async genCloud() {
            this.error = '';
            this.img = '';
            this.genTime = '';
            this.wordCount = 0;
            this.speed = '';
            const start = Date.now();
            try {
                const res = await axios.post('/api/wordcloud', { text: this.text });
                this.img = res.data.img;
                const end = Date.now();
                const seconds = (end - start) / 1000;
                this.genTime = seconds.toFixed(2) + ' 秒';
                this.wordCount = this.text.length;
                this.speed = seconds > 0 ? (this.wordCount / seconds).toFixed(2) + ' 字/秒' : 'N/A';
            } catch(e) {
                this.error = e.response?.data?.error || '生成失败';
            }
        }
    }
}).mount('#app');
</script>
</body>
</html>